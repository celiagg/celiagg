language: generic
matrix:
  include:
    - os: linux
      env: BUILD_TYPE="test" PYTHON="2.7" MINICONDA_OS="Linux" BUILD_ARGS=""
    - os: linux
      env: BUILD_TYPE="test" PYTHON="3.5" MINICONDA_OS="Linux" BUILD_ARGS=""
    - os: linux
      env: BUILD_TYPE="test" PYTHON="3.5" MINICONDA_OS="Linux" BUILD_ARGS="--install-option --no-text-rendering"
    - os: osx
      env: BUILD_TYPE="test" PYTHON="2.7" MINICONDA_OS="MacOSX" BUILD_ARGS=""
    - os: osx
      env: BUILD_TYPE="test" PYTHON="3.5" MINICONDA_OS="MacOSX" BUILD_ARGS=""
    - sudo: required
      services:
        - docker
      env: BUILD_TYPE="package" DOCKER_IMAGE=quay.io/pypa/manylinux1_x86_64

before_install:
  - if [[ $BUILD_TYPE == "test" ]]; then ./travis/test-before-install.sh; fi
install:
  - if [[ $BUILD_TYPE == "test" ]]; then ./travis/test-install.sh; fi
  - if [[ $BUILD_TYPE == "package" && -n $TRAVIS_TAG ]]; then docker pull $DOCKER_IMAGE; fi
script:
  - if [[ $BUILD_TYPE == "test" ]]; then ./travis/test-run.sh; fi
  - if [[ $BUILD_TYPE == "package" && -n $TRAVIS_TAG ]]; then ./travis/build-run.sh; fi

deploy:
  provider: pypi
  user: jwiggins
  password:
    secure: AiYWcQs0N/Sb5bLWC9YAOv91QId+NM7sf60FkTza8zOrbNaSVYAgc2P06jOgapbEqQ7l0CV8b4f7JRvQJ2S9A0J5R8+VTEZnwFxYNsHKj+2Z7s0fCRO62XmdCclQn0YNOBFH0/Rnd+bqe322WsSNHYLsOvSn+RdYVQ47iCNdF3iCZTHX8dIU0Wz7ZZPQCuZrV7x49czT/qgTCjWIvERM1JB8mh4/yrs5nqlHVcAk5BWFUgWw4woeV2uDkMowHxz2KWyx2SO4+mhMOcCzr75zDHfatwe5aVovOWaC+IT4FLLH/OcnSV9ryuppeGn46Ak9E7KQREMClYJOqUZayNs4oxLjSfMy9oYIZ/iLLtAmmZZtIsBMtqtb+c9uXW2uEpmEtcZO28x1ICy7YaxXIqrh9F8X8cPMda4vOxorvE3vPy0ItoQRBGlJJIMnu/J1MLPWNXUkW5YqT4r8bSujMxosjF7MIPXgG7SIOPjRk/MJjMhqoQVCgeQuOSTsuDnrYqL/ZEcY9uNlW8evDxiPCJb6PaFew8uSIY54FbqQ/SGNwqav51YZ9TA1X43oAdZAxrg0GlZLy1JTJjmTgOcbc7dyJLj2x3YkDXjPENaFEnvecUHAWX84X4/QOSP4Fa4JOX1ZBFKj75uLx6WHFPUAo74M/YDTFaWDG/0/dq3EO7oCj3k=
  skip_cleanup: true
  on:
    branch: master
    condition: $BUILD_TYPE = "package"
    tags: true
